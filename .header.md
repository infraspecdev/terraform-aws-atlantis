# terraform-aws-atlantis

This Terraform module automates the deployment of the Atlantis server on an ECS cluster with self-managed EC2 instances. It includes the configuration of an Application Load Balancer (ALB) for traffic routing. The module simplifies the process of setting up and managing Atlantis, enabling automated Terraform pull request workflows.

---

### Architectural Diagram

![atlantis](https://github.com/user-attachments/assets/0252b4a9-38e3-4e8d-9212-fcfc091001a4)

---

## Prerequisites

- Domain with ACM certificate attached
- Application secrets stored in AWS SSM Parameter Store with the following names and descriptions:
  - `/atlantis/ATLANTIS_GH_TOKEN`: A GitHub personal access token with repo and admin:repo_hook permissions. Generate this from GitHub Developer settings.
  - `/atlantis/ATLANTIS_GH_WEBHOOK_SECRET`: The secret used to validate GitHub webhooks. Create a random secret string for this.
  - `/atlantis/AWS_ACCESS_KEY_ID`: The AWS Access Key ID for an IAM user with necessary permissions. Obtain this from AWS IAM user security credentials.
  - `/atlantis/AWS_SECRET_ACCESS_KEY`: The AWS Secret Access Key for the same IAM user. Obtain this from AWS IAM user security credentials.
  - `/atlantis/ATLANTIS_GOOGLE_CLIENT_ID`: The Client ID for Google OAuth. Obtain this from Google Cloud Console.
  - `/atlantis/ATLANTIS_GOOGLE_CLIENT_SECRET`: The Client Secret for Google OAuth. Obtain this from Google Cloud Console.

- Set up the following in the Google Cloud Console for the OAuth consent screen:
  - **Authorized JavaScript origins**:
    - Use the value of `ATLANTIS_URL` from your `locals.tf`, which is defined as:
      ```hcl
      ATLANTIS_URL = "https://${local.atlantis_url}"
      ```

  - **Authorized redirect URIs**:
    - Use the value of `ATLANTIS_GOOGLE_REDIRECT_URI` from your `locals.tf`, which is defined as:
      ```hcl
      ATLANTIS_GOOGLE_REDIRECT_URI = "https://${local.atlantis_url}/oauth2/idpresponse"
      ```
